{
  "library": {
    "annotation": [
      {
        "translatorOptions": "",
        "type": "CqlToElmInfo"
      },
      {
        "libraryId": "MATGlobalCommonFunctions",
        "libraryVersion": "5.0.000",
        "startLine": 277,
        "startChar": 19,
        "endLine": 277,
        "endChar": 53,
        "message": "Could not resolve membership operator for terminology target of the retrieve.",
        "errorType": "semantic",
        "errorSeverity": "warning",
        "type": "CqlToElmError"
      }
    ],
    "identifier": {
      "id": "MATGlobalCommonFunctions",
      "version": "5.0.000"
    },
    "schemaIdentifier": {
      "id": "urn:hl7-org:elm",
      "version": "r1"
    },
    "usings": {
      "def": [
        {
          "localIdentifier": "System",
          "uri": "urn:hl7-org:elm-types:r1"
        },
        {
          "localIdentifier": "FHIR",
          "uri": "http://hl7.org/fhir",
          "version": "4.0.1"
        }
      ]
    },
    "includes": {
      "def": [
        {
          "localIdentifier": "FHIRHelpers",
          "path": "FHIRHelpers",
          "version": "4.0.1"
        }
      ]
    },
    "parameters": {
      "def": [
        {
          "name": "Measurement Period",
          "accessLevel": "Public",
          "default": {
            "lowClosed": true,
            "highClosed": false,
            "type": "Interval",
            "low": {
              "type": "DateTime",
              "year": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "2019",
                "type": "Literal"
              },
              "month": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "1",
                "type": "Literal"
              },
              "day": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "1",
                "type": "Literal"
              },
              "hour": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "0",
                "type": "Literal"
              },
              "minute": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "0",
                "type": "Literal"
              },
              "second": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "0",
                "type": "Literal"
              },
              "millisecond": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "0",
                "type": "Literal"
              }
            },
            "high": {
              "type": "DateTime",
              "year": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "2020",
                "type": "Literal"
              },
              "month": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "1",
                "type": "Literal"
              },
              "day": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "1",
                "type": "Literal"
              },
              "hour": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "0",
                "type": "Literal"
              },
              "minute": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "0",
                "type": "Literal"
              },
              "second": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "0",
                "type": "Literal"
              },
              "millisecond": {
                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                "value": "0",
                "type": "Literal"
              }
            }
          },
          "parameterTypeSpecifier": {
            "type": "IntervalTypeSpecifier",
            "pointType": {
              "name": "{urn:hl7-org:elm-types:r1}DateTime",
              "type": "NamedTypeSpecifier"
            }
          }
        }
      ]
    },
    "codeSystems": {
      "def": [
        {
          "name": "LOINC",
          "id": "http://loinc.org",
          "accessLevel": "Public"
        },
        {
          "name": "SNOMEDCT",
          "id": "http://snomed.info/sct/731000124108",
          "accessLevel": "Public"
        },
        {
          "name": "RoleCode",
          "id": "http://hl7.org/fhir/v3/RoleCode",
          "accessLevel": "Public"
        },
        {
          "name": "Diagnosis Role",
          "id": "http://terminology.hl7.org/CodeSystem/diagnosis-role",
          "accessLevel": "Public"
        },
        {
          "name": "RequestIntent",
          "id": "http://terminology.hl7.org/CodeSystem/request-intent",
          "accessLevel": "Public"
        },
        {
          "name": "MedicationRequestCategory",
          "id": "http://terminology.hl7.org/CodeSystem/medicationrequest-category",
          "accessLevel": "Public"
        },
        {
          "name": "ConditionClinicalStatusCodes",
          "id": "http://terminology.hl7.org/CodeSystem/condition-clinical",
          "accessLevel": "Public"
        },
        {
          "name": "ConditionVerificationStatusCodes",
          "id": "http://terminology.hl7.org/CodeSystem/condition-verification",
          "accessLevel": "Public"
        },
        {
          "name": "AllergyIntoleranceClinicalStatusCodes",
          "id": "http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical",
          "accessLevel": "Public"
        },
        {
          "name": "AllergyIntoleranceVerificationStatusCodes",
          "id": "http://terminology.hl7.org/CodeSystem/allergyintolerance-verification",
          "accessLevel": "Public"
        }
      ]
    },
    "valueSets": {
      "def": [
        {
          "name": "Encounter Inpatient",
          "id": "http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.666.5.307",
          "accessLevel": "Public"
        },
        {
          "name": "Emergency Department Visit",
          "id": "http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.117.1.7.1.292",
          "accessLevel": "Public"
        },
        {
          "name": "Observation Services",
          "id": "http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1111.143",
          "accessLevel": "Public"
        }
      ]
    },
    "codes": {
      "def": [
        {
          "name": "Birthdate",
          "id": "21112-8",
          "display": "Birth date",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "LOINC"
          }
        },
        {
          "name": "Dead",
          "id": "419099009",
          "display": "Dead",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "SNOMEDCT"
          }
        },
        {
          "name": "ER",
          "id": "ER",
          "display": "Emergency room",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "RoleCode"
          }
        },
        {
          "name": "ICU",
          "id": "ICU",
          "display": "Intensive care unit",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "RoleCode"
          }
        },
        {
          "name": "Billing",
          "id": "billing",
          "display": "Billing",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "Diagnosis Role"
          }
        },
        {
          "name": "active",
          "id": "active",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionClinicalStatusCodes"
          }
        },
        {
          "name": "recurrence",
          "id": "recurrence",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionClinicalStatusCodes"
          }
        },
        {
          "name": "relapse",
          "id": "relapse",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionClinicalStatusCodes"
          }
        },
        {
          "name": "inactive",
          "id": "inactive",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionClinicalStatusCodes"
          }
        },
        {
          "name": "remission",
          "id": "remission",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionClinicalStatusCodes"
          }
        },
        {
          "name": "resolved",
          "id": "resolved",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionClinicalStatusCodes"
          }
        },
        {
          "name": "unconfirmed",
          "id": "unconfirmed",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionVerificationStatusCodes"
          }
        },
        {
          "name": "provisional",
          "id": "provisional",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionVerificationStatusCodes"
          }
        },
        {
          "name": "differential",
          "id": "differential",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionVerificationStatusCodes"
          }
        },
        {
          "name": "confirmed",
          "id": "confirmed",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionVerificationStatusCodes"
          }
        },
        {
          "name": "refuted",
          "id": "refuted",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionVerificationStatusCodes"
          }
        },
        {
          "name": "entered-in-error",
          "id": "entered-in-error",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "ConditionVerificationStatusCodes"
          }
        },
        {
          "name": "allergy-active",
          "id": "active",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "AllergyIntoleranceClinicalStatusCodes"
          }
        },
        {
          "name": "allergy-inactive",
          "id": "inactive",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "AllergyIntoleranceClinicalStatusCodes"
          }
        },
        {
          "name": "allergy-resolved",
          "id": "resolved",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "AllergyIntoleranceClinicalStatusCodes"
          }
        },
        {
          "name": "allergy-unconfirmed",
          "id": "unconfirmed",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "AllergyIntoleranceVerificationStatusCodes"
          }
        },
        {
          "name": "allergy-confirmed",
          "id": "confirmed",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "AllergyIntoleranceVerificationStatusCodes"
          }
        },
        {
          "name": "allergy-refuted",
          "id": "refuted",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "AllergyIntoleranceVerificationStatusCodes"
          }
        },
        {
          "name": "Community",
          "id": "community",
          "display": "Community",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "MedicationRequestCategory"
          }
        },
        {
          "name": "Discharge",
          "id": "discharge",
          "display": "Discharge",
          "accessLevel": "Public",
          "codeSystem": {
            "name": "MedicationRequestCategory"
          }
        }
      ]
    },
    "statements": {
      "def": [
        {
          "name": "Patient",
          "context": "Patient",
          "expression": {
            "type": "SingletonFrom",
            "operand": {
              "dataType": "{http://hl7.org/fhir}Patient",
              "templateId": "http://hl7.org/fhir/StructureDefinition/Patient",
              "type": "Retrieve"
            }
          }
        },
        {
          "name": "LengthInDays",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "precision": "Day",
            "type": "DifferenceBetween",
            "operand": [
              {
                "type": "Start",
                "operand": {
                  "name": "Value",
                  "type": "OperandRef"
                }
              },
              {
                "type": "End",
                "operand": {
                  "name": "Value",
                  "type": "OperandRef"
                }
              }
            ]
          },
          "operand": [
            {
              "name": "Value",
              "operandTypeSpecifier": {
                "type": "IntervalTypeSpecifier",
                "pointType": {
                  "name": "{urn:hl7-org:elm-types:r1}DateTime",
                  "type": "NamedTypeSpecifier"
                }
              }
            }
          ]
        },
        {
          "name": "Inpatient Encounter",
          "context": "Patient",
          "accessLevel": "Public",
          "expression": {
            "type": "Query",
            "source": [
              {
                "alias": "EncounterInpatient",
                "expression": {
                  "dataType": "{http://hl7.org/fhir}Encounter",
                  "templateId": "http://hl7.org/fhir/StructureDefinition/Encounter",
                  "codeProperty": "type",
                  "type": "Retrieve",
                  "codes": {
                    "name": "Encounter Inpatient",
                    "type": "ValueSetRef"
                  }
                }
              }
            ],
            "relationship": [],
            "where": {
              "type": "And",
              "operand": [
                {
                  "type": "And",
                  "operand": [
                    {
                      "type": "Equal",
                      "operand": [
                        {
                          "name": "ToString",
                          "libraryName": "FHIRHelpers",
                          "type": "FunctionRef",
                          "operand": [
                            {
                              "path": "status",
                              "scope": "EncounterInpatient",
                              "type": "Property"
                            }
                          ]
                        },
                        {
                          "valueType": "{urn:hl7-org:elm-types:r1}String",
                          "value": "finished",
                          "type": "Literal"
                        }
                      ]
                    },
                    {
                      "type": "LessOrEqual",
                      "operand": [
                        {
                          "name": "LengthInDays",
                          "type": "FunctionRef",
                          "operand": [
                            {
                              "name": "ToInterval",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "period",
                                  "scope": "EncounterInpatient",
                                  "type": "Property"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                          "value": "120",
                          "type": "Literal"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "In",
                  "operand": [
                    {
                      "type": "End",
                      "operand": {
                        "name": "ToInterval",
                        "libraryName": "FHIRHelpers",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "path": "period",
                            "scope": "EncounterInpatient",
                            "type": "Property"
                          }
                        ]
                      }
                    },
                    {
                      "name": "Measurement Period",
                      "type": "ParameterRef"
                    }
                  ]
                }
              ]
            }
          }
        },
        {
          "name": "ToDate",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "DateTime",
            "year": {
              "precision": "Year",
              "type": "DateTimeComponentFrom",
              "operand": {
                "name": "Value",
                "type": "OperandRef"
              }
            },
            "month": {
              "precision": "Month",
              "type": "DateTimeComponentFrom",
              "operand": {
                "name": "Value",
                "type": "OperandRef"
              }
            },
            "day": {
              "precision": "Day",
              "type": "DateTimeComponentFrom",
              "operand": {
                "name": "Value",
                "type": "OperandRef"
              }
            },
            "hour": {
              "valueType": "{urn:hl7-org:elm-types:r1}Integer",
              "value": "0",
              "type": "Literal"
            },
            "minute": {
              "valueType": "{urn:hl7-org:elm-types:r1}Integer",
              "value": "0",
              "type": "Literal"
            },
            "second": {
              "valueType": "{urn:hl7-org:elm-types:r1}Integer",
              "value": "0",
              "type": "Literal"
            },
            "millisecond": {
              "valueType": "{urn:hl7-org:elm-types:r1}Integer",
              "value": "0",
              "type": "Literal"
            },
            "timezoneOffset": {
              "type": "TimezoneOffsetFrom",
              "operand": {
                "name": "Value",
                "type": "OperandRef"
              }
            }
          },
          "operand": [
            {
              "name": "Value",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "CalendarAgeInDaysAt",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "precision": "Day",
            "type": "DurationBetween",
            "operand": [
              {
                "name": "ToDate",
                "type": "FunctionRef",
                "operand": [
                  {
                    "name": "BirthDateTime",
                    "type": "OperandRef"
                  }
                ]
              },
              {
                "name": "ToDate",
                "type": "FunctionRef",
                "operand": [
                  {
                    "name": "AsOf",
                    "type": "OperandRef"
                  }
                ]
              }
            ]
          },
          "operand": [
            {
              "name": "BirthDateTime",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                "type": "NamedTypeSpecifier"
              }
            },
            {
              "name": "AsOf",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "CalendarAgeInDays",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "name": "CalendarAgeInDaysAt",
            "type": "FunctionRef",
            "operand": [
              {
                "name": "BirthDateTime",
                "type": "OperandRef"
              },
              {
                "type": "ToDateTime",
                "operand": {
                  "type": "Today"
                }
              }
            ]
          },
          "operand": [
            {
              "name": "BirthDateTime",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "CalendarAgeInMonthsAt",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "precision": "Month",
            "type": "DurationBetween",
            "operand": [
              {
                "name": "ToDate",
                "type": "FunctionRef",
                "operand": [
                  {
                    "name": "BirthDateTime",
                    "type": "OperandRef"
                  }
                ]
              },
              {
                "name": "ToDate",
                "type": "FunctionRef",
                "operand": [
                  {
                    "name": "AsOf",
                    "type": "OperandRef"
                  }
                ]
              }
            ]
          },
          "operand": [
            {
              "name": "BirthDateTime",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                "type": "NamedTypeSpecifier"
              }
            },
            {
              "name": "AsOf",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "CalendarAgeInMonths",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "name": "CalendarAgeInMonthsAt",
            "type": "FunctionRef",
            "operand": [
              {
                "name": "BirthDateTime",
                "type": "OperandRef"
              },
              {
                "type": "ToDateTime",
                "operand": {
                  "type": "Today"
                }
              }
            ]
          },
          "operand": [
            {
              "name": "BirthDateTime",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "CalendarAgeInYearsAt",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "precision": "Year",
            "type": "DurationBetween",
            "operand": [
              {
                "name": "ToDate",
                "type": "FunctionRef",
                "operand": [
                  {
                    "name": "BirthDateTime",
                    "type": "OperandRef"
                  }
                ]
              },
              {
                "name": "ToDate",
                "type": "FunctionRef",
                "operand": [
                  {
                    "name": "AsOf",
                    "type": "OperandRef"
                  }
                ]
              }
            ]
          },
          "operand": [
            {
              "name": "BirthDateTime",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                "type": "NamedTypeSpecifier"
              }
            },
            {
              "name": "AsOf",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "CalendarAgeInYears",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "name": "CalendarAgeInYearsAt",
            "type": "FunctionRef",
            "operand": [
              {
                "name": "BirthDateTime",
                "type": "OperandRef"
              },
              {
                "type": "ToDateTime",
                "operand": {
                  "type": "Today"
                }
              }
            ]
          },
          "operand": [
            {
              "name": "BirthDateTime",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "ED Visit",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "SingletonFrom",
            "operand": {
              "type": "Query",
              "source": [
                {
                  "alias": "EDVisit",
                  "expression": {
                    "dataType": "{http://hl7.org/fhir}Encounter",
                    "templateId": "http://hl7.org/fhir/StructureDefinition/Encounter",
                    "codeProperty": "type",
                    "type": "Retrieve",
                    "codes": {
                      "name": "Emergency Department Visit",
                      "type": "ValueSetRef"
                    }
                  }
                }
              ],
              "relationship": [],
              "where": {
                "type": "And",
                "operand": [
                  {
                    "type": "Equal",
                    "operand": [
                      {
                        "name": "ToString",
                        "libraryName": "FHIRHelpers",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "path": "status",
                            "scope": "EDVisit",
                            "type": "Property"
                          }
                        ]
                      },
                      {
                        "valueType": "{urn:hl7-org:elm-types:r1}String",
                        "value": "finished",
                        "type": "Literal"
                      }
                    ]
                  },
                  {
                    "type": "And",
                    "operand": [
                      {
                        "type": "In",
                        "operand": [
                          {
                            "type": "End",
                            "operand": {
                              "name": "ToInterval",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "period",
                                  "scope": "EDVisit",
                                  "type": "Property"
                                }
                              ]
                            }
                          },
                          {
                            "lowClosed": true,
                            "highClosed": true,
                            "type": "Interval",
                            "low": {
                              "type": "Subtract",
                              "operand": [
                                {
                                  "type": "Start",
                                  "operand": {
                                    "name": "ToInterval",
                                    "libraryName": "FHIRHelpers",
                                    "type": "FunctionRef",
                                    "operand": [
                                      {
                                        "path": "period",
                                        "type": "Property",
                                        "source": {
                                          "name": "TheEncounter",
                                          "type": "OperandRef"
                                        }
                                      }
                                    ]
                                  }
                                },
                                {
                                  "value": 1,
                                  "unit": "hour",
                                  "type": "Quantity"
                                }
                              ]
                            },
                            "high": {
                              "type": "Start",
                              "operand": {
                                "name": "ToInterval",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "period",
                                    "type": "Property",
                                    "source": {
                                      "name": "TheEncounter",
                                      "type": "OperandRef"
                                    }
                                  }
                                ]
                              }
                            }
                          }
                        ]
                      },
                      {
                        "type": "Not",
                        "operand": {
                          "type": "IsNull",
                          "operand": {
                            "type": "Start",
                            "operand": {
                              "name": "ToInterval",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "period",
                                  "type": "Property",
                                  "source": {
                                    "name": "TheEncounter",
                                    "type": "OperandRef"
                                  }
                                }
                              ]
                            }
                          }
                        }
                      }
                    ]
                  }
                ]
              }
            }
          },
          "operand": [
            {
              "name": "TheEncounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "Hospitalization",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Query",
            "source": [
              {
                "alias": "X",
                "expression": {
                  "name": "ED Visit",
                  "type": "FunctionRef",
                  "operand": [
                    {
                      "name": "TheEncounter",
                      "type": "OperandRef"
                    }
                  ]
                }
              }
            ],
            "relationship": [],
            "return": {
              "expression": {
                "type": "If",
                "condition": {
                  "asType": "{urn:hl7-org:elm-types:r1}Boolean",
                  "type": "As",
                  "operand": {
                    "type": "IsNull",
                    "operand": {
                      "name": "X",
                      "type": "AliasRef"
                    }
                  }
                },
                "then": {
                  "name": "ToInterval",
                  "libraryName": "FHIRHelpers",
                  "type": "FunctionRef",
                  "operand": [
                    {
                      "path": "period",
                      "type": "Property",
                      "source": {
                        "name": "TheEncounter",
                        "type": "OperandRef"
                      }
                    }
                  ]
                },
                "else": {
                  "lowClosed": true,
                  "highClosed": true,
                  "type": "Interval",
                  "low": {
                    "type": "Start",
                    "operand": {
                      "name": "ToInterval",
                      "libraryName": "FHIRHelpers",
                      "type": "FunctionRef",
                      "operand": [
                        {
                          "path": "period",
                          "scope": "X",
                          "type": "Property"
                        }
                      ]
                    }
                  },
                  "high": {
                    "type": "End",
                    "operand": {
                      "name": "ToInterval",
                      "libraryName": "FHIRHelpers",
                      "type": "FunctionRef",
                      "operand": [
                        {
                          "path": "period",
                          "type": "Property",
                          "source": {
                            "name": "TheEncounter",
                            "type": "OperandRef"
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "operand": [
            {
              "name": "TheEncounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "Hospitalization Locations",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Query",
            "source": [
              {
                "alias": "EDEncounter",
                "expression": {
                  "name": "ED Visit",
                  "type": "FunctionRef",
                  "operand": [
                    {
                      "name": "TheEncounter",
                      "type": "OperandRef"
                    }
                  ]
                }
              }
            ],
            "relationship": [],
            "return": {
              "expression": {
                "type": "If",
                "condition": {
                  "asType": "{urn:hl7-org:elm-types:r1}Boolean",
                  "type": "As",
                  "operand": {
                    "type": "IsNull",
                    "operand": {
                      "name": "EDEncounter",
                      "type": "AliasRef"
                    }
                  }
                },
                "then": {
                  "path": "location",
                  "type": "Property",
                  "source": {
                    "name": "TheEncounter",
                    "type": "OperandRef"
                  }
                },
                "else": {
                  "type": "Flatten",
                  "operand": {
                    "type": "List",
                    "element": [
                      {
                        "path": "location",
                        "scope": "EDEncounter",
                        "type": "Property"
                      },
                      {
                        "path": "location",
                        "type": "Property",
                        "source": {
                          "name": "TheEncounter",
                          "type": "OperandRef"
                        }
                      }
                    ]
                  }
                }
              }
            }
          },
          "operand": [
            {
              "name": "TheEncounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "Hospitalization Length of Stay",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "name": "LengthInDays",
            "type": "FunctionRef",
            "operand": [
              {
                "name": "Hospitalization",
                "type": "FunctionRef",
                "operand": [
                  {
                    "name": "TheEncounter",
                    "type": "OperandRef"
                  }
                ]
              }
            ]
          },
          "operand": [
            {
              "name": "TheEncounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "Hospital Admission Time",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Start",
            "operand": {
              "name": "Hospitalization",
              "type": "FunctionRef",
              "operand": [
                {
                  "name": "TheEncounter",
                  "type": "OperandRef"
                }
              ]
            }
          },
          "operand": [
            {
              "name": "TheEncounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "Hospital Discharge Time",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "End",
            "operand": {
              "name": "ToInterval",
              "libraryName": "FHIRHelpers",
              "type": "FunctionRef",
              "operand": [
                {
                  "path": "period",
                  "type": "Property",
                  "source": {
                    "name": "TheEncounter",
                    "type": "OperandRef"
                  }
                }
              ]
            }
          },
          "operand": [
            {
              "name": "TheEncounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "Hospital Arrival Time",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Start",
            "operand": {
              "name": "ToInterval",
              "libraryName": "FHIRHelpers",
              "type": "FunctionRef",
              "operand": [
                {
                  "path": "period",
                  "type": "Property",
                  "source": {
                    "type": "First",
                    "source": {
                      "type": "Query",
                      "source": [
                        {
                          "alias": "HospitalLocation",
                          "expression": {
                            "name": "Hospitalization Locations",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "name": "TheEncounter",
                                "type": "OperandRef"
                              }
                            ]
                          }
                        }
                      ],
                      "relationship": [],
                      "sort": {
                        "by": [
                          {
                            "direction": "asc",
                            "type": "ByExpression",
                            "expression": {
                              "type": "Start",
                              "operand": {
                                "name": "ToInterval",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "name": "period",
                                    "type": "IdentifierRef"
                                  }
                                ]
                              }
                            }
                          }
                        ]
                      }
                    }
                  }
                }
              ]
            }
          },
          "operand": [
            {
              "name": "TheEncounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "HospitalizationWithObservation",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Query",
            "source": [
              {
                "alias": "Visit",
                "expression": {
                  "name": "TheEncounter",
                  "type": "OperandRef"
                }
              }
            ],
            "let": [
              {
                "identifier": "ObsVisit",
                "expression": {
                  "type": "Last",
                  "source": {
                    "type": "Query",
                    "source": [
                      {
                        "alias": "LastObs",
                        "expression": {
                          "dataType": "{http://hl7.org/fhir}Encounter",
                          "templateId": "http://hl7.org/fhir/StructureDefinition/Encounter",
                          "codeProperty": "type",
                          "type": "Retrieve",
                          "codes": {
                            "name": "Observation Services",
                            "type": "ValueSetRef"
                          }
                        }
                      }
                    ],
                    "relationship": [],
                    "where": {
                      "type": "And",
                      "operand": [
                        {
                          "type": "In",
                          "operand": [
                            {
                              "type": "End",
                              "operand": {
                                "name": "ToInterval",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "period",
                                    "scope": "LastObs",
                                    "type": "Property"
                                  }
                                ]
                              }
                            },
                            {
                              "lowClosed": true,
                              "highClosed": true,
                              "type": "Interval",
                              "low": {
                                "type": "Subtract",
                                "operand": [
                                  {
                                    "type": "Start",
                                    "operand": {
                                      "name": "ToInterval",
                                      "libraryName": "FHIRHelpers",
                                      "type": "FunctionRef",
                                      "operand": [
                                        {
                                          "path": "period",
                                          "scope": "Visit",
                                          "type": "Property"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "value": 1,
                                    "unit": "hour",
                                    "type": "Quantity"
                                  }
                                ]
                              },
                              "high": {
                                "type": "Start",
                                "operand": {
                                  "name": "ToInterval",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "period",
                                      "scope": "Visit",
                                      "type": "Property"
                                    }
                                  ]
                                }
                              }
                            }
                          ]
                        },
                        {
                          "type": "Not",
                          "operand": {
                            "type": "IsNull",
                            "operand": {
                              "type": "Start",
                              "operand": {
                                "name": "ToInterval",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "period",
                                    "scope": "Visit",
                                    "type": "Property"
                                  }
                                ]
                              }
                            }
                          }
                        }
                      ]
                    },
                    "sort": {
                      "by": [
                        {
                          "direction": "asc",
                          "type": "ByExpression",
                          "expression": {
                            "type": "End",
                            "operand": {
                              "name": "ToInterval",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "name": "period",
                                  "type": "IdentifierRef"
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              },
              {
                "identifier": "VisitStart",
                "expression": {
                  "type": "Coalesce",
                  "operand": [
                    {
                      "type": "Start",
                      "operand": {
                        "name": "ToInterval",
                        "libraryName": "FHIRHelpers",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "path": "period",
                            "type": "Property",
                            "source": {
                              "name": "ObsVisit",
                              "type": "QueryLetRef"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "type": "Start",
                      "operand": {
                        "name": "ToInterval",
                        "libraryName": "FHIRHelpers",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "path": "period",
                            "scope": "Visit",
                            "type": "Property"
                          }
                        ]
                      }
                    }
                  ]
                }
              },
              {
                "identifier": "EDVisit",
                "expression": {
                  "type": "Last",
                  "source": {
                    "type": "Query",
                    "source": [
                      {
                        "alias": "LastED",
                        "expression": {
                          "dataType": "{http://hl7.org/fhir}Encounter",
                          "templateId": "http://hl7.org/fhir/StructureDefinition/Encounter",
                          "codeProperty": "type",
                          "type": "Retrieve",
                          "codes": {
                            "name": "Emergency Department Visit",
                            "type": "ValueSetRef"
                          }
                        }
                      }
                    ],
                    "relationship": [],
                    "where": {
                      "type": "And",
                      "operand": [
                        {
                          "type": "In",
                          "operand": [
                            {
                              "type": "End",
                              "operand": {
                                "name": "ToInterval",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "period",
                                    "scope": "LastED",
                                    "type": "Property"
                                  }
                                ]
                              }
                            },
                            {
                              "lowClosed": true,
                              "highClosed": true,
                              "type": "Interval",
                              "low": {
                                "type": "Subtract",
                                "operand": [
                                  {
                                    "name": "VisitStart",
                                    "type": "QueryLetRef"
                                  },
                                  {
                                    "value": 1,
                                    "unit": "hour",
                                    "type": "Quantity"
                                  }
                                ]
                              },
                              "high": {
                                "name": "VisitStart",
                                "type": "QueryLetRef"
                              }
                            }
                          ]
                        },
                        {
                          "type": "Not",
                          "operand": {
                            "type": "IsNull",
                            "operand": {
                              "name": "VisitStart",
                              "type": "QueryLetRef"
                            }
                          }
                        }
                      ]
                    },
                    "sort": {
                      "by": [
                        {
                          "direction": "asc",
                          "type": "ByExpression",
                          "expression": {
                            "type": "End",
                            "operand": {
                              "name": "ToInterval",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "name": "period",
                                  "type": "IdentifierRef"
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              }
            ],
            "relationship": [],
            "return": {
              "expression": {
                "lowClosed": true,
                "highClosed": true,
                "type": "Interval",
                "low": {
                  "type": "Coalesce",
                  "operand": [
                    {
                      "type": "Start",
                      "operand": {
                        "name": "ToInterval",
                        "libraryName": "FHIRHelpers",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "path": "period",
                            "type": "Property",
                            "source": {
                              "name": "EDVisit",
                              "type": "QueryLetRef"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "name": "VisitStart",
                      "type": "QueryLetRef"
                    }
                  ]
                },
                "high": {
                  "type": "End",
                  "operand": {
                    "name": "ToInterval",
                    "libraryName": "FHIRHelpers",
                    "type": "FunctionRef",
                    "operand": [
                      {
                        "path": "period",
                        "scope": "Visit",
                        "type": "Property"
                      }
                    ]
                  }
                }
              }
            }
          },
          "operand": [
            {
              "name": "TheEncounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "HospitalizationWithObservationLengthofStay",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "name": "LengthInDays",
            "type": "FunctionRef",
            "operand": [
              {
                "name": "HospitalizationWithObservation",
                "type": "FunctionRef",
                "operand": [
                  {
                    "name": "Encounter",
                    "type": "OperandRef"
                  }
                ]
              }
            ]
          },
          "operand": [
            {
              "name": "Encounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "Normalize Interval",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Case",
            "caseItem": [
              {
                "when": {
                  "type": "Is",
                  "operand": {
                    "name": "choice",
                    "type": "OperandRef"
                  },
                  "isTypeSpecifier": {
                    "name": "{http://hl7.org/fhir}dateTime",
                    "type": "NamedTypeSpecifier"
                  }
                },
                "then": {
                  "lowClosed": true,
                  "highClosed": true,
                  "type": "Interval",
                  "low": {
                    "name": "ToDateTime",
                    "libraryName": "FHIRHelpers",
                    "type": "FunctionRef",
                    "operand": [
                      {
                        "strict": false,
                        "type": "As",
                        "operand": {
                          "name": "choice",
                          "type": "OperandRef"
                        },
                        "asTypeSpecifier": {
                          "name": "{http://hl7.org/fhir}dateTime",
                          "type": "NamedTypeSpecifier"
                        }
                      }
                    ]
                  },
                  "high": {
                    "name": "ToDateTime",
                    "libraryName": "FHIRHelpers",
                    "type": "FunctionRef",
                    "operand": [
                      {
                        "strict": false,
                        "type": "As",
                        "operand": {
                          "name": "choice",
                          "type": "OperandRef"
                        },
                        "asTypeSpecifier": {
                          "name": "{http://hl7.org/fhir}dateTime",
                          "type": "NamedTypeSpecifier"
                        }
                      }
                    ]
                  }
                }
              },
              {
                "when": {
                  "type": "Is",
                  "operand": {
                    "name": "choice",
                    "type": "OperandRef"
                  },
                  "isTypeSpecifier": {
                    "name": "{http://hl7.org/fhir}Period",
                    "type": "NamedTypeSpecifier"
                  }
                },
                "then": {
                  "name": "ToInterval",
                  "libraryName": "FHIRHelpers",
                  "type": "FunctionRef",
                  "operand": [
                    {
                      "strict": false,
                      "type": "As",
                      "operand": {
                        "name": "choice",
                        "type": "OperandRef"
                      },
                      "asTypeSpecifier": {
                        "name": "{http://hl7.org/fhir}Period",
                        "type": "NamedTypeSpecifier"
                      }
                    }
                  ]
                }
              },
              {
                "when": {
                  "type": "Is",
                  "operand": {
                    "name": "choice",
                    "type": "OperandRef"
                  },
                  "isTypeSpecifier": {
                    "name": "{http://hl7.org/fhir}instant",
                    "type": "NamedTypeSpecifier"
                  }
                },
                "then": {
                  "lowClosed": true,
                  "highClosed": true,
                  "type": "Interval",
                  "low": {
                    "name": "ToDateTime",
                    "libraryName": "FHIRHelpers",
                    "type": "FunctionRef",
                    "operand": [
                      {
                        "strict": false,
                        "type": "As",
                        "operand": {
                          "name": "choice",
                          "type": "OperandRef"
                        },
                        "asTypeSpecifier": {
                          "name": "{http://hl7.org/fhir}instant",
                          "type": "NamedTypeSpecifier"
                        }
                      }
                    ]
                  },
                  "high": {
                    "name": "ToDateTime",
                    "libraryName": "FHIRHelpers",
                    "type": "FunctionRef",
                    "operand": [
                      {
                        "strict": false,
                        "type": "As",
                        "operand": {
                          "name": "choice",
                          "type": "OperandRef"
                        },
                        "asTypeSpecifier": {
                          "name": "{http://hl7.org/fhir}instant",
                          "type": "NamedTypeSpecifier"
                        }
                      }
                    ]
                  }
                }
              },
              {
                "when": {
                  "type": "Is",
                  "operand": {
                    "name": "choice",
                    "type": "OperandRef"
                  },
                  "isTypeSpecifier": {
                    "name": "{http://hl7.org/fhir}Age",
                    "type": "NamedTypeSpecifier"
                  }
                },
                "then": {
                  "type": "Interval",
                  "low": {
                    "type": "ToDateTime",
                    "operand": {
                      "path": "low",
                      "type": "Property",
                      "source": {
                        "lowClosed": true,
                        "highClosed": false,
                        "type": "Interval",
                        "low": {
                          "type": "Add",
                          "operand": [
                            {
                              "name": "ToDate",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "birthDate",
                                  "type": "Property",
                                  "source": {
                                    "name": "Patient",
                                    "type": "ExpressionRef"
                                  }
                                }
                              ]
                            },
                            {
                              "name": "ToQuantity",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "strict": false,
                                  "type": "As",
                                  "operand": {
                                    "name": "choice",
                                    "type": "OperandRef"
                                  },
                                  "asTypeSpecifier": {
                                    "name": "{http://hl7.org/fhir}Age",
                                    "type": "NamedTypeSpecifier"
                                  }
                                }
                              ]
                            }
                          ]
                        },
                        "high": {
                          "type": "Add",
                          "operand": [
                            {
                              "type": "Add",
                              "operand": [
                                {
                                  "name": "ToDate",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "birthDate",
                                      "type": "Property",
                                      "source": {
                                        "name": "Patient",
                                        "type": "ExpressionRef"
                                      }
                                    }
                                  ]
                                },
                                {
                                  "name": "ToQuantity",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "strict": false,
                                      "type": "As",
                                      "operand": {
                                        "name": "choice",
                                        "type": "OperandRef"
                                      },
                                      "asTypeSpecifier": {
                                        "name": "{http://hl7.org/fhir}Age",
                                        "type": "NamedTypeSpecifier"
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "value": 1,
                              "unit": "year",
                              "type": "Quantity"
                            }
                          ]
                        }
                      }
                    }
                  },
                  "lowClosedExpression": {
                    "path": "lowClosed",
                    "type": "Property",
                    "source": {
                      "lowClosed": true,
                      "highClosed": false,
                      "type": "Interval",
                      "low": {
                        "type": "Add",
                        "operand": [
                          {
                            "name": "ToDate",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "path": "birthDate",
                                "type": "Property",
                                "source": {
                                  "name": "Patient",
                                  "type": "ExpressionRef"
                                }
                              }
                            ]
                          },
                          {
                            "name": "ToQuantity",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "strict": false,
                                "type": "As",
                                "operand": {
                                  "name": "choice",
                                  "type": "OperandRef"
                                },
                                "asTypeSpecifier": {
                                  "name": "{http://hl7.org/fhir}Age",
                                  "type": "NamedTypeSpecifier"
                                }
                              }
                            ]
                          }
                        ]
                      },
                      "high": {
                        "type": "Add",
                        "operand": [
                          {
                            "type": "Add",
                            "operand": [
                              {
                                "name": "ToDate",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "birthDate",
                                    "type": "Property",
                                    "source": {
                                      "name": "Patient",
                                      "type": "ExpressionRef"
                                    }
                                  }
                                ]
                              },
                              {
                                "name": "ToQuantity",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "strict": false,
                                    "type": "As",
                                    "operand": {
                                      "name": "choice",
                                      "type": "OperandRef"
                                    },
                                    "asTypeSpecifier": {
                                      "name": "{http://hl7.org/fhir}Age",
                                      "type": "NamedTypeSpecifier"
                                    }
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "value": 1,
                            "unit": "year",
                            "type": "Quantity"
                          }
                        ]
                      }
                    }
                  },
                  "high": {
                    "type": "ToDateTime",
                    "operand": {
                      "path": "high",
                      "type": "Property",
                      "source": {
                        "lowClosed": true,
                        "highClosed": false,
                        "type": "Interval",
                        "low": {
                          "type": "Add",
                          "operand": [
                            {
                              "name": "ToDate",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "birthDate",
                                  "type": "Property",
                                  "source": {
                                    "name": "Patient",
                                    "type": "ExpressionRef"
                                  }
                                }
                              ]
                            },
                            {
                              "name": "ToQuantity",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "strict": false,
                                  "type": "As",
                                  "operand": {
                                    "name": "choice",
                                    "type": "OperandRef"
                                  },
                                  "asTypeSpecifier": {
                                    "name": "{http://hl7.org/fhir}Age",
                                    "type": "NamedTypeSpecifier"
                                  }
                                }
                              ]
                            }
                          ]
                        },
                        "high": {
                          "type": "Add",
                          "operand": [
                            {
                              "type": "Add",
                              "operand": [
                                {
                                  "name": "ToDate",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "birthDate",
                                      "type": "Property",
                                      "source": {
                                        "name": "Patient",
                                        "type": "ExpressionRef"
                                      }
                                    }
                                  ]
                                },
                                {
                                  "name": "ToQuantity",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "strict": false,
                                      "type": "As",
                                      "operand": {
                                        "name": "choice",
                                        "type": "OperandRef"
                                      },
                                      "asTypeSpecifier": {
                                        "name": "{http://hl7.org/fhir}Age",
                                        "type": "NamedTypeSpecifier"
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "value": 1,
                              "unit": "year",
                              "type": "Quantity"
                            }
                          ]
                        }
                      }
                    }
                  },
                  "highClosedExpression": {
                    "path": "highClosed",
                    "type": "Property",
                    "source": {
                      "lowClosed": true,
                      "highClosed": false,
                      "type": "Interval",
                      "low": {
                        "type": "Add",
                        "operand": [
                          {
                            "name": "ToDate",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "path": "birthDate",
                                "type": "Property",
                                "source": {
                                  "name": "Patient",
                                  "type": "ExpressionRef"
                                }
                              }
                            ]
                          },
                          {
                            "name": "ToQuantity",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "strict": false,
                                "type": "As",
                                "operand": {
                                  "name": "choice",
                                  "type": "OperandRef"
                                },
                                "asTypeSpecifier": {
                                  "name": "{http://hl7.org/fhir}Age",
                                  "type": "NamedTypeSpecifier"
                                }
                              }
                            ]
                          }
                        ]
                      },
                      "high": {
                        "type": "Add",
                        "operand": [
                          {
                            "type": "Add",
                            "operand": [
                              {
                                "name": "ToDate",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "birthDate",
                                    "type": "Property",
                                    "source": {
                                      "name": "Patient",
                                      "type": "ExpressionRef"
                                    }
                                  }
                                ]
                              },
                              {
                                "name": "ToQuantity",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "strict": false,
                                    "type": "As",
                                    "operand": {
                                      "name": "choice",
                                      "type": "OperandRef"
                                    },
                                    "asTypeSpecifier": {
                                      "name": "{http://hl7.org/fhir}Age",
                                      "type": "NamedTypeSpecifier"
                                    }
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "value": 1,
                            "unit": "year",
                            "type": "Quantity"
                          }
                        ]
                      }
                    }
                  }
                }
              },
              {
                "when": {
                  "type": "Is",
                  "operand": {
                    "name": "choice",
                    "type": "OperandRef"
                  },
                  "isTypeSpecifier": {
                    "name": "{http://hl7.org/fhir}Range",
                    "type": "NamedTypeSpecifier"
                  }
                },
                "then": {
                  "type": "Interval",
                  "low": {
                    "type": "ToDateTime",
                    "operand": {
                      "path": "low",
                      "type": "Property",
                      "source": {
                        "lowClosed": true,
                        "highClosed": false,
                        "type": "Interval",
                        "low": {
                          "type": "Add",
                          "operand": [
                            {
                              "name": "ToDate",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "birthDate",
                                  "type": "Property",
                                  "source": {
                                    "name": "Patient",
                                    "type": "ExpressionRef"
                                  }
                                }
                              ]
                            },
                            {
                              "name": "ToQuantity",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "low",
                                  "type": "Property",
                                  "source": {
                                    "strict": false,
                                    "type": "As",
                                    "operand": {
                                      "name": "choice",
                                      "type": "OperandRef"
                                    },
                                    "asTypeSpecifier": {
                                      "name": "{http://hl7.org/fhir}Range",
                                      "type": "NamedTypeSpecifier"
                                    }
                                  }
                                }
                              ]
                            }
                          ]
                        },
                        "high": {
                          "type": "Add",
                          "operand": [
                            {
                              "type": "Add",
                              "operand": [
                                {
                                  "name": "ToDate",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "birthDate",
                                      "type": "Property",
                                      "source": {
                                        "name": "Patient",
                                        "type": "ExpressionRef"
                                      }
                                    }
                                  ]
                                },
                                {
                                  "name": "ToQuantity",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "high",
                                      "type": "Property",
                                      "source": {
                                        "strict": false,
                                        "type": "As",
                                        "operand": {
                                          "name": "choice",
                                          "type": "OperandRef"
                                        },
                                        "asTypeSpecifier": {
                                          "name": "{http://hl7.org/fhir}Range",
                                          "type": "NamedTypeSpecifier"
                                        }
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "value": 1,
                              "unit": "year",
                              "type": "Quantity"
                            }
                          ]
                        }
                      }
                    }
                  },
                  "lowClosedExpression": {
                    "path": "lowClosed",
                    "type": "Property",
                    "source": {
                      "lowClosed": true,
                      "highClosed": false,
                      "type": "Interval",
                      "low": {
                        "type": "Add",
                        "operand": [
                          {
                            "name": "ToDate",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "path": "birthDate",
                                "type": "Property",
                                "source": {
                                  "name": "Patient",
                                  "type": "ExpressionRef"
                                }
                              }
                            ]
                          },
                          {
                            "name": "ToQuantity",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "path": "low",
                                "type": "Property",
                                "source": {
                                  "strict": false,
                                  "type": "As",
                                  "operand": {
                                    "name": "choice",
                                    "type": "OperandRef"
                                  },
                                  "asTypeSpecifier": {
                                    "name": "{http://hl7.org/fhir}Range",
                                    "type": "NamedTypeSpecifier"
                                  }
                                }
                              }
                            ]
                          }
                        ]
                      },
                      "high": {
                        "type": "Add",
                        "operand": [
                          {
                            "type": "Add",
                            "operand": [
                              {
                                "name": "ToDate",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "birthDate",
                                    "type": "Property",
                                    "source": {
                                      "name": "Patient",
                                      "type": "ExpressionRef"
                                    }
                                  }
                                ]
                              },
                              {
                                "name": "ToQuantity",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "high",
                                    "type": "Property",
                                    "source": {
                                      "strict": false,
                                      "type": "As",
                                      "operand": {
                                        "name": "choice",
                                        "type": "OperandRef"
                                      },
                                      "asTypeSpecifier": {
                                        "name": "{http://hl7.org/fhir}Range",
                                        "type": "NamedTypeSpecifier"
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "value": 1,
                            "unit": "year",
                            "type": "Quantity"
                          }
                        ]
                      }
                    }
                  },
                  "high": {
                    "type": "ToDateTime",
                    "operand": {
                      "path": "high",
                      "type": "Property",
                      "source": {
                        "lowClosed": true,
                        "highClosed": false,
                        "type": "Interval",
                        "low": {
                          "type": "Add",
                          "operand": [
                            {
                              "name": "ToDate",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "birthDate",
                                  "type": "Property",
                                  "source": {
                                    "name": "Patient",
                                    "type": "ExpressionRef"
                                  }
                                }
                              ]
                            },
                            {
                              "name": "ToQuantity",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "low",
                                  "type": "Property",
                                  "source": {
                                    "strict": false,
                                    "type": "As",
                                    "operand": {
                                      "name": "choice",
                                      "type": "OperandRef"
                                    },
                                    "asTypeSpecifier": {
                                      "name": "{http://hl7.org/fhir}Range",
                                      "type": "NamedTypeSpecifier"
                                    }
                                  }
                                }
                              ]
                            }
                          ]
                        },
                        "high": {
                          "type": "Add",
                          "operand": [
                            {
                              "type": "Add",
                              "operand": [
                                {
                                  "name": "ToDate",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "birthDate",
                                      "type": "Property",
                                      "source": {
                                        "name": "Patient",
                                        "type": "ExpressionRef"
                                      }
                                    }
                                  ]
                                },
                                {
                                  "name": "ToQuantity",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "high",
                                      "type": "Property",
                                      "source": {
                                        "strict": false,
                                        "type": "As",
                                        "operand": {
                                          "name": "choice",
                                          "type": "OperandRef"
                                        },
                                        "asTypeSpecifier": {
                                          "name": "{http://hl7.org/fhir}Range",
                                          "type": "NamedTypeSpecifier"
                                        }
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "value": 1,
                              "unit": "year",
                              "type": "Quantity"
                            }
                          ]
                        }
                      }
                    }
                  },
                  "highClosedExpression": {
                    "path": "highClosed",
                    "type": "Property",
                    "source": {
                      "lowClosed": true,
                      "highClosed": false,
                      "type": "Interval",
                      "low": {
                        "type": "Add",
                        "operand": [
                          {
                            "name": "ToDate",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "path": "birthDate",
                                "type": "Property",
                                "source": {
                                  "name": "Patient",
                                  "type": "ExpressionRef"
                                }
                              }
                            ]
                          },
                          {
                            "name": "ToQuantity",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "path": "low",
                                "type": "Property",
                                "source": {
                                  "strict": false,
                                  "type": "As",
                                  "operand": {
                                    "name": "choice",
                                    "type": "OperandRef"
                                  },
                                  "asTypeSpecifier": {
                                    "name": "{http://hl7.org/fhir}Range",
                                    "type": "NamedTypeSpecifier"
                                  }
                                }
                              }
                            ]
                          }
                        ]
                      },
                      "high": {
                        "type": "Add",
                        "operand": [
                          {
                            "type": "Add",
                            "operand": [
                              {
                                "name": "ToDate",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "birthDate",
                                    "type": "Property",
                                    "source": {
                                      "name": "Patient",
                                      "type": "ExpressionRef"
                                    }
                                  }
                                ]
                              },
                              {
                                "name": "ToQuantity",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "high",
                                    "type": "Property",
                                    "source": {
                                      "strict": false,
                                      "type": "As",
                                      "operand": {
                                        "name": "choice",
                                        "type": "OperandRef"
                                      },
                                      "asTypeSpecifier": {
                                        "name": "{http://hl7.org/fhir}Range",
                                        "type": "NamedTypeSpecifier"
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "value": 1,
                            "unit": "year",
                            "type": "Quantity"
                          }
                        ]
                      }
                    }
                  }
                }
              },
              {
                "when": {
                  "type": "Is",
                  "operand": {
                    "name": "choice",
                    "type": "OperandRef"
                  },
                  "isTypeSpecifier": {
                    "name": "{http://hl7.org/fhir}Timing",
                    "type": "NamedTypeSpecifier"
                  }
                },
                "then": {
                  "type": "Message",
                  "source": {
                    "strict": false,
                    "type": "As",
                    "operand": {
                      "type": "Null"
                    },
                    "asTypeSpecifier": {
                      "type": "IntervalTypeSpecifier",
                      "pointType": {
                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                        "type": "NamedTypeSpecifier"
                      }
                    }
                  },
                  "condition": {
                    "valueType": "{urn:hl7-org:elm-types:r1}Boolean",
                    "value": "true",
                    "type": "Literal"
                  },
                  "code": {
                    "valueType": "{urn:hl7-org:elm-types:r1}String",
                    "value": "1",
                    "type": "Literal"
                  },
                  "severity": {
                    "valueType": "{urn:hl7-org:elm-types:r1}String",
                    "value": "Error",
                    "type": "Literal"
                  },
                  "message": {
                    "valueType": "{urn:hl7-org:elm-types:r1}String",
                    "value": "Cannot compute a single interval from a Timing type",
                    "type": "Literal"
                  }
                }
              },
              {
                "when": {
                  "type": "Is",
                  "operand": {
                    "name": "choice",
                    "type": "OperandRef"
                  },
                  "isTypeSpecifier": {
                    "name": "{http://hl7.org/fhir}string",
                    "type": "NamedTypeSpecifier"
                  }
                },
                "then": {
                  "type": "Message",
                  "source": {
                    "strict": false,
                    "type": "As",
                    "operand": {
                      "type": "Null"
                    },
                    "asTypeSpecifier": {
                      "type": "IntervalTypeSpecifier",
                      "pointType": {
                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                        "type": "NamedTypeSpecifier"
                      }
                    }
                  },
                  "condition": {
                    "valueType": "{urn:hl7-org:elm-types:r1}Boolean",
                    "value": "true",
                    "type": "Literal"
                  },
                  "code": {
                    "valueType": "{urn:hl7-org:elm-types:r1}String",
                    "value": "1",
                    "type": "Literal"
                  },
                  "severity": {
                    "valueType": "{urn:hl7-org:elm-types:r1}String",
                    "value": "Error",
                    "type": "Literal"
                  },
                  "message": {
                    "valueType": "{urn:hl7-org:elm-types:r1}String",
                    "value": "Cannot compute an interval from a String value",
                    "type": "Literal"
                  }
                }
              }
            ],
            "else": {
              "strict": false,
              "type": "As",
              "operand": {
                "type": "Null"
              },
              "asTypeSpecifier": {
                "type": "IntervalTypeSpecifier",
                "pointType": {
                  "name": "{urn:hl7-org:elm-types:r1}DateTime",
                  "type": "NamedTypeSpecifier"
                }
              }
            }
          },
          "operand": [
            {
              "name": "choice",
              "operandTypeSpecifier": {
                "type": "ChoiceTypeSpecifier",
                "choice": [
                  {
                    "name": "{http://hl7.org/fhir}dateTime",
                    "type": "NamedTypeSpecifier"
                  },
                  {
                    "name": "{http://hl7.org/fhir}Period",
                    "type": "NamedTypeSpecifier"
                  },
                  {
                    "name": "{http://hl7.org/fhir}Timing",
                    "type": "NamedTypeSpecifier"
                  },
                  {
                    "name": "{http://hl7.org/fhir}instant",
                    "type": "NamedTypeSpecifier"
                  },
                  {
                    "name": "{http://hl7.org/fhir}string",
                    "type": "NamedTypeSpecifier"
                  },
                  {
                    "name": "{http://hl7.org/fhir}Age",
                    "type": "NamedTypeSpecifier"
                  },
                  {
                    "name": "{http://hl7.org/fhir}Range",
                    "type": "NamedTypeSpecifier"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "Normalize Abatement",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "If",
            "condition": {
              "asType": "{urn:hl7-org:elm-types:r1}Boolean",
              "type": "As",
              "operand": {
                "type": "Is",
                "operand": {
                  "path": "abatement",
                  "type": "Property",
                  "source": {
                    "name": "condition",
                    "type": "OperandRef"
                  }
                },
                "isTypeSpecifier": {
                  "name": "{http://hl7.org/fhir}dateTime",
                  "type": "NamedTypeSpecifier"
                }
              }
            },
            "then": {
              "lowClosed": true,
              "highClosed": true,
              "type": "Interval",
              "low": {
                "name": "ToDateTime",
                "libraryName": "FHIRHelpers",
                "type": "FunctionRef",
                "operand": [
                  {
                    "strict": false,
                    "type": "As",
                    "operand": {
                      "path": "abatement",
                      "type": "Property",
                      "source": {
                        "name": "condition",
                        "type": "OperandRef"
                      }
                    },
                    "asTypeSpecifier": {
                      "name": "{http://hl7.org/fhir}dateTime",
                      "type": "NamedTypeSpecifier"
                    }
                  }
                ]
              },
              "high": {
                "name": "ToDateTime",
                "libraryName": "FHIRHelpers",
                "type": "FunctionRef",
                "operand": [
                  {
                    "strict": false,
                    "type": "As",
                    "operand": {
                      "path": "abatement",
                      "type": "Property",
                      "source": {
                        "name": "condition",
                        "type": "OperandRef"
                      }
                    },
                    "asTypeSpecifier": {
                      "name": "{http://hl7.org/fhir}dateTime",
                      "type": "NamedTypeSpecifier"
                    }
                  }
                ]
              }
            },
            "else": {
              "type": "If",
              "condition": {
                "asType": "{urn:hl7-org:elm-types:r1}Boolean",
                "type": "As",
                "operand": {
                  "type": "Is",
                  "operand": {
                    "path": "abatement",
                    "type": "Property",
                    "source": {
                      "name": "condition",
                      "type": "OperandRef"
                    }
                  },
                  "isTypeSpecifier": {
                    "name": "{http://hl7.org/fhir}Period",
                    "type": "NamedTypeSpecifier"
                  }
                }
              },
              "then": {
                "name": "ToInterval",
                "libraryName": "FHIRHelpers",
                "type": "FunctionRef",
                "operand": [
                  {
                    "strict": false,
                    "type": "As",
                    "operand": {
                      "path": "abatement",
                      "type": "Property",
                      "source": {
                        "name": "condition",
                        "type": "OperandRef"
                      }
                    },
                    "asTypeSpecifier": {
                      "name": "{http://hl7.org/fhir}Period",
                      "type": "NamedTypeSpecifier"
                    }
                  }
                ]
              },
              "else": {
                "type": "If",
                "condition": {
                  "asType": "{urn:hl7-org:elm-types:r1}Boolean",
                  "type": "As",
                  "operand": {
                    "type": "Is",
                    "operand": {
                      "path": "abatement",
                      "type": "Property",
                      "source": {
                        "name": "condition",
                        "type": "OperandRef"
                      }
                    },
                    "isTypeSpecifier": {
                      "name": "{http://hl7.org/fhir}string",
                      "type": "NamedTypeSpecifier"
                    }
                  }
                },
                "then": {
                  "type": "Message",
                  "source": {
                    "strict": false,
                    "type": "As",
                    "operand": {
                      "type": "Null"
                    },
                    "asTypeSpecifier": {
                      "type": "IntervalTypeSpecifier",
                      "pointType": {
                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                        "type": "NamedTypeSpecifier"
                      }
                    }
                  },
                  "condition": {
                    "valueType": "{urn:hl7-org:elm-types:r1}Boolean",
                    "value": "true",
                    "type": "Literal"
                  },
                  "code": {
                    "valueType": "{urn:hl7-org:elm-types:r1}String",
                    "value": "1",
                    "type": "Literal"
                  },
                  "severity": {
                    "valueType": "{urn:hl7-org:elm-types:r1}String",
                    "value": "Error",
                    "type": "Literal"
                  },
                  "message": {
                    "valueType": "{urn:hl7-org:elm-types:r1}String",
                    "value": "Cannot compute an interval from a String value",
                    "type": "Literal"
                  }
                },
                "else": {
                  "type": "If",
                  "condition": {
                    "asType": "{urn:hl7-org:elm-types:r1}Boolean",
                    "type": "As",
                    "operand": {
                      "type": "Is",
                      "operand": {
                        "path": "abatement",
                        "type": "Property",
                        "source": {
                          "name": "condition",
                          "type": "OperandRef"
                        }
                      },
                      "isTypeSpecifier": {
                        "name": "{http://hl7.org/fhir}Age",
                        "type": "NamedTypeSpecifier"
                      }
                    }
                  },
                  "then": {
                    "type": "Interval",
                    "low": {
                      "type": "ToDateTime",
                      "operand": {
                        "path": "low",
                        "type": "Property",
                        "source": {
                          "lowClosed": true,
                          "highClosed": false,
                          "type": "Interval",
                          "low": {
                            "type": "Add",
                            "operand": [
                              {
                                "name": "ToDate",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "birthDate",
                                    "type": "Property",
                                    "source": {
                                      "name": "Patient",
                                      "type": "ExpressionRef"
                                    }
                                  }
                                ]
                              },
                              {
                                "name": "ToQuantity",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "strict": false,
                                    "type": "As",
                                    "operand": {
                                      "path": "abatement",
                                      "type": "Property",
                                      "source": {
                                        "name": "condition",
                                        "type": "OperandRef"
                                      }
                                    },
                                    "asTypeSpecifier": {
                                      "name": "{http://hl7.org/fhir}Age",
                                      "type": "NamedTypeSpecifier"
                                    }
                                  }
                                ]
                              }
                            ]
                          },
                          "high": {
                            "type": "Add",
                            "operand": [
                              {
                                "type": "Add",
                                "operand": [
                                  {
                                    "name": "ToDate",
                                    "libraryName": "FHIRHelpers",
                                    "type": "FunctionRef",
                                    "operand": [
                                      {
                                        "path": "birthDate",
                                        "type": "Property",
                                        "source": {
                                          "name": "Patient",
                                          "type": "ExpressionRef"
                                        }
                                      }
                                    ]
                                  },
                                  {
                                    "name": "ToQuantity",
                                    "libraryName": "FHIRHelpers",
                                    "type": "FunctionRef",
                                    "operand": [
                                      {
                                        "strict": false,
                                        "type": "As",
                                        "operand": {
                                          "path": "abatement",
                                          "type": "Property",
                                          "source": {
                                            "name": "condition",
                                            "type": "OperandRef"
                                          }
                                        },
                                        "asTypeSpecifier": {
                                          "name": "{http://hl7.org/fhir}Age",
                                          "type": "NamedTypeSpecifier"
                                        }
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "value": 1,
                                "unit": "year",
                                "type": "Quantity"
                              }
                            ]
                          }
                        }
                      }
                    },
                    "lowClosedExpression": {
                      "path": "lowClosed",
                      "type": "Property",
                      "source": {
                        "lowClosed": true,
                        "highClosed": false,
                        "type": "Interval",
                        "low": {
                          "type": "Add",
                          "operand": [
                            {
                              "name": "ToDate",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "birthDate",
                                  "type": "Property",
                                  "source": {
                                    "name": "Patient",
                                    "type": "ExpressionRef"
                                  }
                                }
                              ]
                            },
                            {
                              "name": "ToQuantity",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "strict": false,
                                  "type": "As",
                                  "operand": {
                                    "path": "abatement",
                                    "type": "Property",
                                    "source": {
                                      "name": "condition",
                                      "type": "OperandRef"
                                    }
                                  },
                                  "asTypeSpecifier": {
                                    "name": "{http://hl7.org/fhir}Age",
                                    "type": "NamedTypeSpecifier"
                                  }
                                }
                              ]
                            }
                          ]
                        },
                        "high": {
                          "type": "Add",
                          "operand": [
                            {
                              "type": "Add",
                              "operand": [
                                {
                                  "name": "ToDate",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "birthDate",
                                      "type": "Property",
                                      "source": {
                                        "name": "Patient",
                                        "type": "ExpressionRef"
                                      }
                                    }
                                  ]
                                },
                                {
                                  "name": "ToQuantity",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "strict": false,
                                      "type": "As",
                                      "operand": {
                                        "path": "abatement",
                                        "type": "Property",
                                        "source": {
                                          "name": "condition",
                                          "type": "OperandRef"
                                        }
                                      },
                                      "asTypeSpecifier": {
                                        "name": "{http://hl7.org/fhir}Age",
                                        "type": "NamedTypeSpecifier"
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "value": 1,
                              "unit": "year",
                              "type": "Quantity"
                            }
                          ]
                        }
                      }
                    },
                    "high": {
                      "type": "ToDateTime",
                      "operand": {
                        "path": "high",
                        "type": "Property",
                        "source": {
                          "lowClosed": true,
                          "highClosed": false,
                          "type": "Interval",
                          "low": {
                            "type": "Add",
                            "operand": [
                              {
                                "name": "ToDate",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "birthDate",
                                    "type": "Property",
                                    "source": {
                                      "name": "Patient",
                                      "type": "ExpressionRef"
                                    }
                                  }
                                ]
                              },
                              {
                                "name": "ToQuantity",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "strict": false,
                                    "type": "As",
                                    "operand": {
                                      "path": "abatement",
                                      "type": "Property",
                                      "source": {
                                        "name": "condition",
                                        "type": "OperandRef"
                                      }
                                    },
                                    "asTypeSpecifier": {
                                      "name": "{http://hl7.org/fhir}Age",
                                      "type": "NamedTypeSpecifier"
                                    }
                                  }
                                ]
                              }
                            ]
                          },
                          "high": {
                            "type": "Add",
                            "operand": [
                              {
                                "type": "Add",
                                "operand": [
                                  {
                                    "name": "ToDate",
                                    "libraryName": "FHIRHelpers",
                                    "type": "FunctionRef",
                                    "operand": [
                                      {
                                        "path": "birthDate",
                                        "type": "Property",
                                        "source": {
                                          "name": "Patient",
                                          "type": "ExpressionRef"
                                        }
                                      }
                                    ]
                                  },
                                  {
                                    "name": "ToQuantity",
                                    "libraryName": "FHIRHelpers",
                                    "type": "FunctionRef",
                                    "operand": [
                                      {
                                        "strict": false,
                                        "type": "As",
                                        "operand": {
                                          "path": "abatement",
                                          "type": "Property",
                                          "source": {
                                            "name": "condition",
                                            "type": "OperandRef"
                                          }
                                        },
                                        "asTypeSpecifier": {
                                          "name": "{http://hl7.org/fhir}Age",
                                          "type": "NamedTypeSpecifier"
                                        }
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "value": 1,
                                "unit": "year",
                                "type": "Quantity"
                              }
                            ]
                          }
                        }
                      }
                    },
                    "highClosedExpression": {
                      "path": "highClosed",
                      "type": "Property",
                      "source": {
                        "lowClosed": true,
                        "highClosed": false,
                        "type": "Interval",
                        "low": {
                          "type": "Add",
                          "operand": [
                            {
                              "name": "ToDate",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "path": "birthDate",
                                  "type": "Property",
                                  "source": {
                                    "name": "Patient",
                                    "type": "ExpressionRef"
                                  }
                                }
                              ]
                            },
                            {
                              "name": "ToQuantity",
                              "libraryName": "FHIRHelpers",
                              "type": "FunctionRef",
                              "operand": [
                                {
                                  "strict": false,
                                  "type": "As",
                                  "operand": {
                                    "path": "abatement",
                                    "type": "Property",
                                    "source": {
                                      "name": "condition",
                                      "type": "OperandRef"
                                    }
                                  },
                                  "asTypeSpecifier": {
                                    "name": "{http://hl7.org/fhir}Age",
                                    "type": "NamedTypeSpecifier"
                                  }
                                }
                              ]
                            }
                          ]
                        },
                        "high": {
                          "type": "Add",
                          "operand": [
                            {
                              "type": "Add",
                              "operand": [
                                {
                                  "name": "ToDate",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "birthDate",
                                      "type": "Property",
                                      "source": {
                                        "name": "Patient",
                                        "type": "ExpressionRef"
                                      }
                                    }
                                  ]
                                },
                                {
                                  "name": "ToQuantity",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "strict": false,
                                      "type": "As",
                                      "operand": {
                                        "path": "abatement",
                                        "type": "Property",
                                        "source": {
                                          "name": "condition",
                                          "type": "OperandRef"
                                        }
                                      },
                                      "asTypeSpecifier": {
                                        "name": "{http://hl7.org/fhir}Age",
                                        "type": "NamedTypeSpecifier"
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "value": 1,
                              "unit": "year",
                              "type": "Quantity"
                            }
                          ]
                        }
                      }
                    }
                  },
                  "else": {
                    "type": "If",
                    "condition": {
                      "asType": "{urn:hl7-org:elm-types:r1}Boolean",
                      "type": "As",
                      "operand": {
                        "type": "Is",
                        "operand": {
                          "path": "abatement",
                          "type": "Property",
                          "source": {
                            "name": "condition",
                            "type": "OperandRef"
                          }
                        },
                        "isTypeSpecifier": {
                          "name": "{http://hl7.org/fhir}Range",
                          "type": "NamedTypeSpecifier"
                        }
                      }
                    },
                    "then": {
                      "type": "Interval",
                      "low": {
                        "type": "ToDateTime",
                        "operand": {
                          "path": "low",
                          "type": "Property",
                          "source": {
                            "lowClosed": true,
                            "highClosed": false,
                            "type": "Interval",
                            "low": {
                              "type": "Add",
                              "operand": [
                                {
                                  "name": "ToDate",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "birthDate",
                                      "type": "Property",
                                      "source": {
                                        "name": "Patient",
                                        "type": "ExpressionRef"
                                      }
                                    }
                                  ]
                                },
                                {
                                  "name": "ToQuantity",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "low",
                                      "type": "Property",
                                      "source": {
                                        "strict": false,
                                        "type": "As",
                                        "operand": {
                                          "path": "abatement",
                                          "type": "Property",
                                          "source": {
                                            "name": "condition",
                                            "type": "OperandRef"
                                          }
                                        },
                                        "asTypeSpecifier": {
                                          "name": "{http://hl7.org/fhir}Range",
                                          "type": "NamedTypeSpecifier"
                                        }
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            "high": {
                              "type": "Add",
                              "operand": [
                                {
                                  "type": "Add",
                                  "operand": [
                                    {
                                      "name": "ToDate",
                                      "libraryName": "FHIRHelpers",
                                      "type": "FunctionRef",
                                      "operand": [
                                        {
                                          "path": "birthDate",
                                          "type": "Property",
                                          "source": {
                                            "name": "Patient",
                                            "type": "ExpressionRef"
                                          }
                                        }
                                      ]
                                    },
                                    {
                                      "name": "ToQuantity",
                                      "libraryName": "FHIRHelpers",
                                      "type": "FunctionRef",
                                      "operand": [
                                        {
                                          "path": "high",
                                          "type": "Property",
                                          "source": {
                                            "strict": false,
                                            "type": "As",
                                            "operand": {
                                              "path": "abatement",
                                              "type": "Property",
                                              "source": {
                                                "name": "condition",
                                                "type": "OperandRef"
                                              }
                                            },
                                            "asTypeSpecifier": {
                                              "name": "{http://hl7.org/fhir}Range",
                                              "type": "NamedTypeSpecifier"
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "value": 1,
                                  "unit": "year",
                                  "type": "Quantity"
                                }
                              ]
                            }
                          }
                        }
                      },
                      "lowClosedExpression": {
                        "path": "lowClosed",
                        "type": "Property",
                        "source": {
                          "lowClosed": true,
                          "highClosed": false,
                          "type": "Interval",
                          "low": {
                            "type": "Add",
                            "operand": [
                              {
                                "name": "ToDate",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "birthDate",
                                    "type": "Property",
                                    "source": {
                                      "name": "Patient",
                                      "type": "ExpressionRef"
                                    }
                                  }
                                ]
                              },
                              {
                                "name": "ToQuantity",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "low",
                                    "type": "Property",
                                    "source": {
                                      "strict": false,
                                      "type": "As",
                                      "operand": {
                                        "path": "abatement",
                                        "type": "Property",
                                        "source": {
                                          "name": "condition",
                                          "type": "OperandRef"
                                        }
                                      },
                                      "asTypeSpecifier": {
                                        "name": "{http://hl7.org/fhir}Range",
                                        "type": "NamedTypeSpecifier"
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          },
                          "high": {
                            "type": "Add",
                            "operand": [
                              {
                                "type": "Add",
                                "operand": [
                                  {
                                    "name": "ToDate",
                                    "libraryName": "FHIRHelpers",
                                    "type": "FunctionRef",
                                    "operand": [
                                      {
                                        "path": "birthDate",
                                        "type": "Property",
                                        "source": {
                                          "name": "Patient",
                                          "type": "ExpressionRef"
                                        }
                                      }
                                    ]
                                  },
                                  {
                                    "name": "ToQuantity",
                                    "libraryName": "FHIRHelpers",
                                    "type": "FunctionRef",
                                    "operand": [
                                      {
                                        "path": "high",
                                        "type": "Property",
                                        "source": {
                                          "strict": false,
                                          "type": "As",
                                          "operand": {
                                            "path": "abatement",
                                            "type": "Property",
                                            "source": {
                                              "name": "condition",
                                              "type": "OperandRef"
                                            }
                                          },
                                          "asTypeSpecifier": {
                                            "name": "{http://hl7.org/fhir}Range",
                                            "type": "NamedTypeSpecifier"
                                          }
                                        }
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "value": 1,
                                "unit": "year",
                                "type": "Quantity"
                              }
                            ]
                          }
                        }
                      },
                      "high": {
                        "type": "ToDateTime",
                        "operand": {
                          "path": "high",
                          "type": "Property",
                          "source": {
                            "lowClosed": true,
                            "highClosed": false,
                            "type": "Interval",
                            "low": {
                              "type": "Add",
                              "operand": [
                                {
                                  "name": "ToDate",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "birthDate",
                                      "type": "Property",
                                      "source": {
                                        "name": "Patient",
                                        "type": "ExpressionRef"
                                      }
                                    }
                                  ]
                                },
                                {
                                  "name": "ToQuantity",
                                  "libraryName": "FHIRHelpers",
                                  "type": "FunctionRef",
                                  "operand": [
                                    {
                                      "path": "low",
                                      "type": "Property",
                                      "source": {
                                        "strict": false,
                                        "type": "As",
                                        "operand": {
                                          "path": "abatement",
                                          "type": "Property",
                                          "source": {
                                            "name": "condition",
                                            "type": "OperandRef"
                                          }
                                        },
                                        "asTypeSpecifier": {
                                          "name": "{http://hl7.org/fhir}Range",
                                          "type": "NamedTypeSpecifier"
                                        }
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            "high": {
                              "type": "Add",
                              "operand": [
                                {
                                  "type": "Add",
                                  "operand": [
                                    {
                                      "name": "ToDate",
                                      "libraryName": "FHIRHelpers",
                                      "type": "FunctionRef",
                                      "operand": [
                                        {
                                          "path": "birthDate",
                                          "type": "Property",
                                          "source": {
                                            "name": "Patient",
                                            "type": "ExpressionRef"
                                          }
                                        }
                                      ]
                                    },
                                    {
                                      "name": "ToQuantity",
                                      "libraryName": "FHIRHelpers",
                                      "type": "FunctionRef",
                                      "operand": [
                                        {
                                          "path": "high",
                                          "type": "Property",
                                          "source": {
                                            "strict": false,
                                            "type": "As",
                                            "operand": {
                                              "path": "abatement",
                                              "type": "Property",
                                              "source": {
                                                "name": "condition",
                                                "type": "OperandRef"
                                              }
                                            },
                                            "asTypeSpecifier": {
                                              "name": "{http://hl7.org/fhir}Range",
                                              "type": "NamedTypeSpecifier"
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "value": 1,
                                  "unit": "year",
                                  "type": "Quantity"
                                }
                              ]
                            }
                          }
                        }
                      },
                      "highClosedExpression": {
                        "path": "highClosed",
                        "type": "Property",
                        "source": {
                          "lowClosed": true,
                          "highClosed": false,
                          "type": "Interval",
                          "low": {
                            "type": "Add",
                            "operand": [
                              {
                                "name": "ToDate",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "birthDate",
                                    "type": "Property",
                                    "source": {
                                      "name": "Patient",
                                      "type": "ExpressionRef"
                                    }
                                  }
                                ]
                              },
                              {
                                "name": "ToQuantity",
                                "libraryName": "FHIRHelpers",
                                "type": "FunctionRef",
                                "operand": [
                                  {
                                    "path": "low",
                                    "type": "Property",
                                    "source": {
                                      "strict": false,
                                      "type": "As",
                                      "operand": {
                                        "path": "abatement",
                                        "type": "Property",
                                        "source": {
                                          "name": "condition",
                                          "type": "OperandRef"
                                        }
                                      },
                                      "asTypeSpecifier": {
                                        "name": "{http://hl7.org/fhir}Range",
                                        "type": "NamedTypeSpecifier"
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          },
                          "high": {
                            "type": "Add",
                            "operand": [
                              {
                                "type": "Add",
                                "operand": [
                                  {
                                    "name": "ToDate",
                                    "libraryName": "FHIRHelpers",
                                    "type": "FunctionRef",
                                    "operand": [
                                      {
                                        "path": "birthDate",
                                        "type": "Property",
                                        "source": {
                                          "name": "Patient",
                                          "type": "ExpressionRef"
                                        }
                                      }
                                    ]
                                  },
                                  {
                                    "name": "ToQuantity",
                                    "libraryName": "FHIRHelpers",
                                    "type": "FunctionRef",
                                    "operand": [
                                      {
                                        "path": "high",
                                        "type": "Property",
                                        "source": {
                                          "strict": false,
                                          "type": "As",
                                          "operand": {
                                            "path": "abatement",
                                            "type": "Property",
                                            "source": {
                                              "name": "condition",
                                              "type": "OperandRef"
                                            }
                                          },
                                          "asTypeSpecifier": {
                                            "name": "{http://hl7.org/fhir}Range",
                                            "type": "NamedTypeSpecifier"
                                          }
                                        }
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "value": 1,
                                "unit": "year",
                                "type": "Quantity"
                              }
                            ]
                          }
                        }
                      }
                    },
                    "else": {
                      "type": "If",
                      "condition": {
                        "asType": "{urn:hl7-org:elm-types:r1}Boolean",
                        "type": "As",
                        "operand": {
                          "type": "Is",
                          "operand": {
                            "path": "abatement",
                            "type": "Property",
                            "source": {
                              "name": "condition",
                              "type": "OperandRef"
                            }
                          },
                          "isTypeSpecifier": {
                            "name": "{http://hl7.org/fhir}boolean",
                            "type": "NamedTypeSpecifier"
                          }
                        }
                      },
                      "then": {
                        "lowClosed": true,
                        "highClosed": false,
                        "type": "Interval",
                        "low": {
                          "type": "End",
                          "operand": {
                            "name": "Normalize Interval",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "path": "onset",
                                "type": "Property",
                                "source": {
                                  "name": "condition",
                                  "type": "OperandRef"
                                }
                              }
                            ]
                          }
                        },
                        "high": {
                          "name": "ToDateTime",
                          "libraryName": "FHIRHelpers",
                          "type": "FunctionRef",
                          "operand": [
                            {
                              "path": "recordedDate",
                              "type": "Property",
                              "source": {
                                "name": "condition",
                                "type": "OperandRef"
                              }
                            }
                          ]
                        }
                      },
                      "else": {
                        "type": "As",
                        "operand": {
                          "type": "Null"
                        },
                        "asTypeSpecifier": {
                          "type": "IntervalTypeSpecifier",
                          "pointType": {
                            "name": "{urn:hl7-org:elm-types:r1}DateTime",
                            "type": "NamedTypeSpecifier"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "operand": [
            {
              "name": "condition",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Condition",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "Prevalence Period",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "lowClosed": true,
            "highClosed": false,
            "type": "Interval",
            "low": {
              "type": "Start",
              "operand": {
                "name": "Normalize Interval",
                "type": "FunctionRef",
                "operand": [
                  {
                    "path": "onset",
                    "type": "Property",
                    "source": {
                      "name": "condition",
                      "type": "OperandRef"
                    }
                  }
                ]
              }
            },
            "high": {
              "type": "End",
              "operand": {
                "name": "Normalize Abatement",
                "type": "FunctionRef",
                "operand": [
                  {
                    "name": "condition",
                    "type": "OperandRef"
                  }
                ]
              }
            }
          },
          "operand": [
            {
              "name": "condition",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Condition",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "GetId",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Last",
            "source": {
              "type": "Split",
              "stringToSplit": {
                "name": "uri",
                "type": "OperandRef"
              },
              "separator": {
                "valueType": "{urn:hl7-org:elm-types:r1}String",
                "value": "/",
                "type": "Literal"
              }
            }
          },
          "operand": [
            {
              "name": "uri",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}String",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "EncounterDiagnosis",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Query",
            "source": [
              {
                "alias": "D",
                "expression": {
                  "path": "diagnosis",
                  "type": "Property",
                  "source": {
                    "name": "Encounter",
                    "type": "OperandRef"
                  }
                }
              }
            ],
            "relationship": [],
            "return": {
              "expression": {
                "type": "SingletonFrom",
                "operand": {
                  "type": "Query",
                  "source": [
                    {
                      "alias": "C",
                      "expression": {
                        "dataType": "{http://hl7.org/fhir}Condition",
                        "templateId": "http://hl7.org/fhir/StructureDefinition/Condition",
                        "type": "Retrieve"
                      }
                    }
                  ],
                  "relationship": [],
                  "where": {
                    "type": "Equal",
                    "operand": [
                      {
                        "name": "ToString",
                        "libraryName": "FHIRHelpers",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "path": "id",
                            "scope": "C",
                            "type": "Property"
                          }
                        ]
                      },
                      {
                        "name": "GetId",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "name": "ToString",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "path": "reference",
                                "type": "Property",
                                "source": {
                                  "path": "condition",
                                  "scope": "D",
                                  "type": "Property"
                                }
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                }
              }
            }
          },
          "operand": [
            {
              "name": "Encounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "PrincipalDiagnosis",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Query",
            "source": [
              {
                "alias": "PD",
                "expression": {
                  "type": "SingletonFrom",
                  "operand": {
                    "type": "Query",
                    "source": [
                      {
                        "alias": "D",
                        "expression": {
                          "path": "diagnosis",
                          "type": "Property",
                          "source": {
                            "name": "Encounter",
                            "type": "OperandRef"
                          }
                        }
                      }
                    ],
                    "relationship": [],
                    "where": {
                      "type": "Equal",
                      "operand": [
                        {
                          "name": "ToInteger",
                          "libraryName": "FHIRHelpers",
                          "type": "FunctionRef",
                          "operand": [
                            {
                              "path": "rank",
                              "scope": "D",
                              "type": "Property"
                            }
                          ]
                        },
                        {
                          "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                          "value": "1",
                          "type": "Literal"
                        }
                      ]
                    }
                  }
                }
              }
            ],
            "relationship": [],
            "return": {
              "expression": {
                "type": "SingletonFrom",
                "operand": {
                  "type": "Query",
                  "source": [
                    {
                      "alias": "C",
                      "expression": {
                        "dataType": "{http://hl7.org/fhir}Condition",
                        "templateId": "http://hl7.org/fhir/StructureDefinition/Condition",
                        "type": "Retrieve"
                      }
                    }
                  ],
                  "relationship": [],
                  "where": {
                    "type": "Equal",
                    "operand": [
                      {
                        "name": "ToString",
                        "libraryName": "FHIRHelpers",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "path": "id",
                            "scope": "C",
                            "type": "Property"
                          }
                        ]
                      },
                      {
                        "name": "GetId",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "name": "ToString",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "path": "reference",
                                "type": "Property",
                                "source": {
                                  "path": "condition",
                                  "scope": "PD",
                                  "type": "Property"
                                }
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                }
              }
            }
          },
          "operand": [
            {
              "name": "Encounter",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Encounter",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "GetLocation",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "SingletonFrom",
            "operand": {
              "type": "Query",
              "source": [
                {
                  "alias": "L",
                  "expression": {
                    "dataType": "{http://hl7.org/fhir}Location",
                    "templateId": "http://hl7.org/fhir/StructureDefinition/Location",
                    "type": "Retrieve"
                  }
                }
              ],
              "relationship": [],
              "where": {
                "type": "Equal",
                "operand": [
                  {
                    "name": "ToString",
                    "libraryName": "FHIRHelpers",
                    "type": "FunctionRef",
                    "operand": [
                      {
                        "path": "id",
                        "scope": "L",
                        "type": "Property"
                      }
                    ]
                  },
                  {
                    "name": "GetId",
                    "type": "FunctionRef",
                    "operand": [
                      {
                        "name": "ToString",
                        "libraryName": "FHIRHelpers",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "path": "reference",
                            "type": "Property",
                            "source": {
                              "name": "reference",
                              "type": "OperandRef"
                            }
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            }
          },
          "operand": [
            {
              "name": "reference",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Reference",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "GetExtensions",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Query",
            "source": [
              {
                "alias": "E",
                "expression": {
                  "path": "extension",
                  "type": "Property",
                  "source": {
                    "name": "domainResource",
                    "type": "OperandRef"
                  }
                }
              }
            ],
            "relationship": [],
            "where": {
              "type": "Equal",
              "operand": [
                {
                  "name": "ToString",
                  "libraryName": "FHIRHelpers",
                  "type": "FunctionRef",
                  "operand": [
                    {
                      "path": "url",
                      "scope": "E",
                      "type": "Property"
                    }
                  ]
                },
                {
                  "type": "Concatenate",
                  "operand": [
                    {
                      "valueType": "{urn:hl7-org:elm-types:r1}String",
                      "value": "http://hl7.org/fhir/us/qicore/StructureDefinition/",
                      "type": "Literal"
                    },
                    {
                      "name": "url",
                      "type": "OperandRef"
                    }
                  ]
                }
              ]
            },
            "return": {
              "expression": {
                "name": "E",
                "type": "AliasRef"
              }
            }
          },
          "operand": [
            {
              "name": "domainResource",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}DomainResource",
                "type": "NamedTypeSpecifier"
              }
            },
            {
              "name": "url",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}String",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "GetExtension",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "SingletonFrom",
            "operand": {
              "name": "GetExtensions",
              "type": "FunctionRef",
              "operand": [
                {
                  "name": "domainResource",
                  "type": "OperandRef"
                },
                {
                  "name": "url",
                  "type": "OperandRef"
                }
              ]
            }
          },
          "operand": [
            {
              "name": "domainResource",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}DomainResource",
                "type": "NamedTypeSpecifier"
              }
            },
            {
              "name": "url",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}String",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "GetExtensions",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Query",
            "source": [
              {
                "alias": "E",
                "expression": {
                  "path": "extension",
                  "type": "Property",
                  "source": {
                    "name": "element",
                    "type": "OperandRef"
                  }
                }
              }
            ],
            "relationship": [],
            "where": {
              "type": "Equal",
              "operand": [
                {
                  "name": "ToString",
                  "libraryName": "FHIRHelpers",
                  "type": "FunctionRef",
                  "operand": [
                    {
                      "path": "url",
                      "scope": "E",
                      "type": "Property"
                    }
                  ]
                },
                {
                  "name": "url",
                  "type": "OperandRef"
                }
              ]
            },
            "return": {
              "expression": {
                "name": "E",
                "type": "AliasRef"
              }
            }
          },
          "operand": [
            {
              "name": "element",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Element",
                "type": "NamedTypeSpecifier"
              }
            },
            {
              "name": "url",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}String",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "GetExtension",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "SingletonFrom",
            "operand": {
              "name": "GetExtensions",
              "type": "FunctionRef",
              "operand": [
                {
                  "name": "element",
                  "type": "OperandRef"
                },
                {
                  "name": "url",
                  "type": "OperandRef"
                }
              ]
            }
          },
          "operand": [
            {
              "name": "element",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Element",
                "type": "NamedTypeSpecifier"
              }
            },
            {
              "name": "url",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}String",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "GetBaseExtensions",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "Query",
            "source": [
              {
                "alias": "E",
                "expression": {
                  "path": "extension",
                  "type": "Property",
                  "source": {
                    "name": "domainResource",
                    "type": "OperandRef"
                  }
                }
              }
            ],
            "relationship": [],
            "where": {
              "type": "Equal",
              "operand": [
                {
                  "name": "ToString",
                  "libraryName": "FHIRHelpers",
                  "type": "FunctionRef",
                  "operand": [
                    {
                      "path": "url",
                      "scope": "E",
                      "type": "Property"
                    }
                  ]
                },
                {
                  "type": "Concatenate",
                  "operand": [
                    {
                      "valueType": "{urn:hl7-org:elm-types:r1}String",
                      "value": "http://hl7.org/fhir/StructureDefinition/",
                      "type": "Literal"
                    },
                    {
                      "name": "url",
                      "type": "OperandRef"
                    }
                  ]
                }
              ]
            },
            "return": {
              "expression": {
                "name": "E",
                "type": "AliasRef"
              }
            }
          },
          "operand": [
            {
              "name": "domainResource",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}DomainResource",
                "type": "NamedTypeSpecifier"
              }
            },
            {
              "name": "url",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}String",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "GetBaseExtension",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "SingletonFrom",
            "operand": {
              "name": "GetBaseExtensions",
              "type": "FunctionRef",
              "operand": [
                {
                  "name": "domainResource",
                  "type": "OperandRef"
                },
                {
                  "name": "url",
                  "type": "OperandRef"
                }
              ]
            }
          },
          "operand": [
            {
              "name": "domainResource",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}DomainResource",
                "type": "NamedTypeSpecifier"
              }
            },
            {
              "name": "url",
              "operandTypeSpecifier": {
                "name": "{urn:hl7-org:elm-types:r1}String",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "GetProvenance",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "SingletonFrom",
            "operand": {
              "dataType": "{http://hl7.org/fhir}Provenance",
              "templateId": "http://hl7.org/fhir/StructureDefinition/Provenance",
              "codeProperty": "target",
              "type": "Retrieve",
              "codes": {
                "type": "ToList",
                "operand": {
                  "path": "id",
                  "type": "Property",
                  "source": {
                    "name": "resource",
                    "type": "OperandRef"
                  }
                }
              }
            }
          },
          "operand": [
            {
              "name": "resource",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}Resource",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        },
        {
          "name": "GetMedicationCode",
          "context": "Patient",
          "accessLevel": "Public",
          "type": "FunctionDef",
          "expression": {
            "type": "If",
            "condition": {
              "asType": "{urn:hl7-org:elm-types:r1}Boolean",
              "type": "As",
              "operand": {
                "type": "Is",
                "operand": {
                  "path": "medication",
                  "type": "Property",
                  "source": {
                    "name": "request",
                    "type": "OperandRef"
                  }
                },
                "isTypeSpecifier": {
                  "name": "{http://hl7.org/fhir}CodeableConcept",
                  "type": "NamedTypeSpecifier"
                }
              }
            },
            "then": {
              "strict": false,
              "type": "As",
              "operand": {
                "path": "medication",
                "type": "Property",
                "source": {
                  "name": "request",
                  "type": "OperandRef"
                }
              },
              "asTypeSpecifier": {
                "name": "{http://hl7.org/fhir}CodeableConcept",
                "type": "NamedTypeSpecifier"
              }
            },
            "else": {
              "path": "code",
              "type": "Property",
              "source": {
                "type": "SingletonFrom",
                "operand": {
                  "type": "Query",
                  "source": [
                    {
                      "alias": "M",
                      "expression": {
                        "dataType": "{http://hl7.org/fhir}Medication",
                        "templateId": "http://hl7.org/fhir/StructureDefinition/Medication",
                        "type": "Retrieve"
                      }
                    }
                  ],
                  "relationship": [],
                  "where": {
                    "type": "Equal",
                    "operand": [
                      {
                        "name": "ToString",
                        "libraryName": "FHIRHelpers",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "path": "id",
                            "scope": "M",
                            "type": "Property"
                          }
                        ]
                      },
                      {
                        "name": "GetId",
                        "type": "FunctionRef",
                        "operand": [
                          {
                            "name": "ToString",
                            "libraryName": "FHIRHelpers",
                            "type": "FunctionRef",
                            "operand": [
                              {
                                "path": "reference",
                                "type": "Property",
                                "source": {
                                  "strict": false,
                                  "type": "As",
                                  "operand": {
                                    "path": "medication",
                                    "type": "Property",
                                    "source": {
                                      "name": "request",
                                      "type": "OperandRef"
                                    }
                                  },
                                  "asTypeSpecifier": {
                                    "name": "{http://hl7.org/fhir}Reference",
                                    "type": "NamedTypeSpecifier"
                                  }
                                }
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                }
              }
            }
          },
          "operand": [
            {
              "name": "request",
              "operandTypeSpecifier": {
                "name": "{http://hl7.org/fhir}MedicationRequest",
                "type": "NamedTypeSpecifier"
              }
            }
          ]
        }
      ]
    }
  }
}